<div class="grid grid-4 mb-3">
    <div class="card">
        <div class="flex justify-between items-center mb-1">
            <h3 style="font-size: 1rem; color: var(--text-secondary); margin: 0;">Total Appointments</h3>
            <i class="fas fa-calendar fa-lg text-primary"></i>
        </div>
        <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">
            <%= stats.totalAppointments.toLocaleString() %>
        </div>
        <div style="font-size: 0.875rem; color: var(--text-muted);">All time</div>
    </div>

    <div class="card" style="border-left: 4px solid var(--warning);">
        <div class="flex justify-between items-center mb-1">
            <h3 style="font-size: 1rem; color: var(--text-secondary); margin: 0;">Pending</h3>
            <i class="fas fa-clock fa-lg text-warning"></i>
        </div>
        <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">
            <%= stats.pendingAppointments.toLocaleString() %>
        </div>
        <div style="font-size: 0.875rem; color: var(--text-muted);">Needs attention</div>
    </div>

    <div class="card">
        <div class="flex justify-between items-center mb-1">
            <h3 style="font-size: 1rem; color: var(--text-secondary); margin: 0;">Total Customers</h3>
            <i class="fas fa-users fa-lg text-success"></i>
        </div>
        <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary);">
            <%= stats.totalCustomers.toLocaleString() %>
        </div>
        <div style="font-size: 0.875rem; color: var(--text-muted);">Registered users</div>
    </div>

    <div class="card">
        <div class="flex justify-between items-center mb-1">
            <h3 style="font-size: 1rem; color: var(--text-secondary); margin: 0;">Total Revenue</h3>
            <i class="fas fa-dollar-sign fa-lg text-gold"></i>
        </div>
        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-gold);">$<%= parseFloat(stats.totalRevenue ||
                0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
        </div>
        <div style="font-size: 0.875rem; color: var(--text-muted);">All time</div>
    </div>
</div>

<div class="grid grid-3 mb-3">
    <div class="card" style="grid-column: span 2;">
        <h3 class="mb-2">Revenue Overview</h3>
        <div id="revenueChart" style="min-height: 300px;"></div>
    </div>
    <div class="card">
        <h3 class="mb-2">Appointment Status</h3>
        <div id="statusChart" style="min-height: 300px;"></div>
    </div>
</div>

<div class="grid grid-2">
    <!-- Today's Appointments -->
    <div class="card">
        <div class="flex justify-between items-center mb-2">
            <h3 class="mb-0">Today's Appointments</h3>
            <span class="badge badge-neutral">
                <%= todaysAppointments.length %>
            </span>
        </div>

        <% if (todaysAppointments.length> 0) { %>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Customer</th>
                            <th>Service</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% todaysAppointments.forEach(appointment=> { %>
                            <tr onclick="window.location.href='/admin/appointments'" style="cursor: pointer;">
                                <td><strong>
                                        <%= moment(appointment.appointment_date).format('HH:mm') %>
                                    </strong></td>
                                <td>
                                    <%= appointment.customer.name %>
                                </td>
                                <td>
                                    <%= appointment.service.name %>
                                </td>
                                <td>
                                    <span class="badge badge-<%= 
                                    appointment.status === 'confirmed' ? 'success' : 
                                    appointment.status === 'pending' ? 'warning' : 
                                    appointment.status === 'completed' ? 'neutral' : 
                                    appointment.status === 'cancelled' ? 'error' : 'neutral' 
                                %>">
                                        <%= appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1) %>
                                    </span>
                                </td>
                            </tr>
                            <% }) %>
                    </tbody>
                </table>
            </div>
            <div class="text-center mt-2">
                <a href="/admin/appointments" class="btn btn-outline btn-block">View All Appointments</a>
            </div>
            <% } else { %>
                <div class="text-center py-3">
                    <p>No appointments scheduled for today</p>
                    <a href="/admin/appointments" class="btn btn-primary">Schedule Appointment</a>
                </div>
                <% } %>
    </div>

    <!-- Recent Ratings -->
    <div class="card">
        <div class="flex justify-between items-center mb-2">
            <h3 class="mb-0">Recent Ratings</h3>
            <span class="badge badge-neutral">
                <%= recentRatings.length %>
            </span>
        </div>

        <% if (recentRatings.length> 0) { %>
            <div class="grid gap-2">
                <% recentRatings.forEach(rating=> { %>
                    <div
                        style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--border-radius-md);">
                        <div class="flex justify-between mb-1">
                            <strong>
                                <%= rating.customer.name %>
                            </strong>
                            <small class="text-muted">
                                <%= moment(rating.created_at).fromNow() %>
                            </small>
                        </div>
                        <div class="mb-1" style="color: #fbbf24;">
                            <% for(let i=1; i <=5; i++) { %>
                                <i class="fas fa-star<%= i > rating.rating ? '-o' : '' %>"></i>
                                <% } %>
                                    <span class="text-muted ml-1">
                                        <%= rating.rating %>/5
                                    </span>
                        </div>
                        <p class="mb-0" style="font-size: 0.875rem;">
                            <%= rating.review || 'No review text' %>
                        </p>
                    </div>
                    <% }) %>
            </div>
            <div class="text-center mt-2">
                <a href="/admin/ratings" class="btn btn-outline btn-block">View All Ratings</a>
            </div>
            <% } else { %>
                <div class="text-center py-3">
                    <p>No ratings yet</p>
                </div>
                <% } %>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Revenue Chart
        const revenueChart = new ApexCharts(document.querySelector("#revenueChart"), {
            series: [{
                name: 'Revenue',
                data: [30, 40, 35, 50, 49, 60, 70, 91, 125, 150, 170, 190] // Placeholder data, should be dynamic
            }],
            chart: {
                height: 300,
                type: 'area',
                toolbar: { show: false },
                background: 'transparent'
            },
            theme: { mode: 'dark' },
            colors: ['#d4af37'],
            stroke: { curve: 'smooth', width: 2 },
            fill: {
                type: 'gradient',
                gradient: {
                    shadeIntensity: 1,
                    opacityFrom: 0.7,
                    opacityTo: 0.1,
                    stops: [0, 90, 100]
                }
            },
            xaxis: {
                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                labels: { style: { colors: '#a0a0a0' } }
            },
            yaxis: {
                labels: { style: { colors: '#a0a0a0' } }
            },
            grid: { borderColor: '#333' }
        });
        revenueChart.render();

        // Status Chart
        const statusChart = new ApexCharts(document.querySelector("#statusChart"), {
            series: [44, 55, 13, 43], // Placeholder
            chart: {
                height: 300,
                type: 'donut',
                background: 'transparent'
            },
            theme: { mode: 'dark' },
            colors: ['#10b981', '#f59e0b', '#3b82f6', '#ef4444'],
            labels: ['Completed', 'Pending', 'In Progress', 'Cancelled'],
            legend: { position: 'bottom', labels: { colors: '#a0a0a0' } },
            stroke: { show: false }
        });
        statusChart.render();

        // Fetch real data
        fetch('/admin/api/dashboard-stats')
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    // Update charts logic here
                }
            });
    });
</script>