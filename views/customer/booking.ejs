<div class="container" style="padding: 4rem 0;">
    <div class="text-center mb-5">
        <h1 class="mb-2">Book Your Appointment</h1>
        <p class="text-muted" style="max-width: 600px; margin: 0 auto;">
            Choose your service, barber, and preferred time for your grooming session
        </p>
    </div>

    <div class="card" style="max-width: 800px; margin: 0 auto; padding: 2rem;">
        <form id="bookingForm" action="/appointments/book" method="POST">
            <!-- Step 1: Service Selection -->
            <div class="form-step active" id="step1">
                <h3 class="mb-3 flex items-center gap-2">
                    <span class="badge badge-primary rounded-full w-8 h-8 flex items-center justify-center">1</span>
                    Choose Your Service
                </h3>

                <div class="grid gap-3 mb-4">
                    <% if (services && services.length> 0) { %>
                        <% services.forEach(service=> { %>
                            <label
                                class="card hover-lift cursor-pointer p-3 border-transparent hover:border-gold transition-all"
                                style="border: 1px solid var(--border-color);">
                                <div class="flex items-center gap-3">
                                    <input type="radio" name="service_id" value="<%= service.id %>" required
                                        data-price="<%= service.price %>" data-duration="<%= service.duration %>"
                                        class="form-radio text-gold">
                                    <div class="flex-1">
                                        <div class="flex justify-between items-center mb-1">
                                            <h4 class="mb-0 text-lg">
                                                <%= service.name %>
                                            </h4>
                                            <div class="text-gold font-bold text-lg">$<%= service.price %>
                                            </div>
                                        </div>
                                        <% if (service.description) { %>
                                            <p class="text-muted text-sm mb-1">
                                                <%= service.description %>
                                            </p>
                                            <% } %>
                                                <div class="flex gap-3 text-xs text-muted">
                                                    <span><i class="fas fa-clock mr-1"></i>
                                                        <%= service.duration %> mins
                                                    </span>
                                                    <span class="badge badge-neutral text-xs">
                                                        <%= service.category %>
                                                    </span>
                                                </div>
                                    </div>
                                </div>
                            </label>
                            <% }) %>
                                <% } else { %>
                                    <div class="text-center py-4 text-muted">
                                        <p>No services available at the moment.</p>
                                    </div>
                                    <% } %>
                </div>

                <div class="text-right">
                    <button type="button" class="btn btn-primary next-step" data-next="step2">
                        Next: Choose Barber <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Barber Selection -->
            <div class="form-step hidden" id="step2">
                <h3 class="mb-3 flex items-center gap-2">
                    <span class="badge badge-primary rounded-full w-8 h-8 flex items-center justify-center">2</span>
                    Select Your Barber
                </h3>

                <div class="grid grid-2 gap-3 mb-4">
                    <% if (barbers && barbers.length> 0) { %>
                        <% barbers.forEach(barber=> { %>
                            <label
                                class="card hover-lift cursor-pointer p-3 border-transparent hover:border-gold transition-all text-center"
                                style="border: 1px solid var(--border-color);">
                                <input type="radio" name="barber_id" value="<%= barber.id %>" required class="hidden">
                                <div class="avatar-circle mx-auto mb-2"
                                    style="width: 80px; height: 80px; background: var(--bg-tertiary); font-size: 1.5rem; display: flex; align-items: center; justify-content: center;">
                                    <%= barber.name.split(' ').map(n => n[0]).join('') %>
                                </div>
                                <h4 class="mb-1"><%= barber.name %></h4>
                                <% if (barber.specialty) { %>
                                    <p class="text-gold text-sm mb-1"><%= barber.specialty %></p>
                                <% } %>
                                <p class="text-muted text-xs"><%= barber.experience %> years exp</p>
                            </label>
                        <% }) %>
                    <% } else { %>
                        <div class="text-center py-4 text-muted col-span-2">
                            <p>No barbers available at the moment.</p>
                        </div>
                    <% } %>
                </div>
                
                <div class="flex justify-between">
                    <button type="button" class="btn btn-outline prev-step" data-prev="step1">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="button" class="btn btn-primary next-step" data-next="step3">
                        Next: Choose Date & Time <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Date & Time Selection -->
            <div class="form-step hidden" id="step3">
                <h3 class="mb-3 flex items-center gap-2">
                    <span class="badge badge-primary rounded-full w-8 h-8 flex items-center justify-center">3</span>
                    Select Date & Time
                </h3>
                
                <div class="grid gap-4 mb-4">
                    <div class="form-group">
                        <label for="appointment_date" class="form-label">Select Date</label>
                        <input type="date" id="appointment_date" name="appointment_date" 
                               class="form-control" required min="<%= new Date().toISOString().split(' T')[0] %>">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Available Time Slots</label>
                                    <div id="timeSlots" class="grid grid-4 gap-2">
                                        <p class="text-muted col-span-4 text-center py-2">Please select a date first to
                                            see available time slots</p>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="notes" class="form-label">Additional Notes (Optional)</label>
                                    <textarea id="notes" name="notes" class="form-control"
                                        placeholder="Any special requests or requirements..." rows="3"></textarea>
                                </div>
                </div>

                <!-- Appointment Summary -->
                <div class="bg-tertiary p-4 rounded mb-4 border border-color">
                    <h4 class="mb-3 border-b border-color pb-2">Appointment Summary</h4>
                    <div class="grid gap-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-muted">Service:</span>
                            <span id="summaryService" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Barber:</span>
                            <span id="summaryBarber" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Date & Time:</span>
                            <span id="summaryDateTime" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Duration:</span>
                            <span id="summaryDuration" class="font-medium">-</span>
                        </div>
                        <div class="flex justify-between text-lg font-bold text-gold mt-2 pt-2 border-t border-color">
                            <span>Total:</span>
                            <span id="summaryTotal">$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between">
                    <button type="button" class="btn btn-outline prev-step" data-prev="step2">
                        <i class="fas fa-arrow-left mr-2"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Confirm Booking <i class="fas fa-check ml-2"></i>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Simple step navigation logic
    document.querySelectorAll('.next-step').forEach(btn => {
        btn.addEventListener('click', () => {
            const currentStep = btn.closest('.form-step');
            const nextStepId = btn.dataset.next;

            // Basic validation
            const inputs = currentStep.querySelectorAll('input[required]');
            let valid = true;
            inputs.forEach(input => {
                if (input.type === 'radio' && !currentStep.querySelector(`input[name="${input.name}"]:checked`)) {
                    valid = false;
                } else if (!input.checkValidity()) {
                    valid = false;
                    input.reportValidity();
                }
            });

            if (valid) {
                currentStep.classList.add('hidden');
                document.getElementById(nextStepId).classList.remove('hidden');
                updateSummary();
            } else if (inputs.length > 0 && inputs[0].type === 'radio') {
                alert('Please make a selection to continue');
            }
        });
    });

    document.querySelectorAll('.prev-step').forEach(btn => {
        btn.addEventListener('click', () => {
            const currentStep = btn.closest('.form-step');
            const prevStepId = btn.dataset.prev;
            currentStep.classList.add('hidden');
            document.getElementById(prevStepId).classList.remove('hidden');
        });
    });

    function updateSummary() {
        const serviceInput = document.querySelector('input[name="service_id"]:checked');
        const barberInput = document.querySelector('input[name="barber_id"]:checked');
        const dateInput = document.getElementById('appointment_date');

        if (serviceInput) {
            const container = serviceInput.closest('label');
            document.getElementById('summaryService').textContent = container.querySelector('h4').textContent;
            document.getElementById('summaryTotal').textContent = '$' + serviceInput.dataset.price;
            document.getElementById('summaryDuration').textContent = serviceInput.dataset.duration + ' mins';
        }

        if (barberInput) {
            const container = barberInput.closest('label');
            document.getElementById('summaryBarber').textContent = container.querySelector('h4').textContent;
        }

        if (dateInput.value) {
            document.getElementById('summaryDateTime').textContent = dateInput.value; // Add time when selected
        }
    }

    // Mock time slots for demo
    document.getElementById('appointment_date').addEventListener('change', function () {
        const slotsContainer = document.getElementById('timeSlots');
        slotsContainer.innerHTML = '';
        const times = ['09:00', '10:00', '11:00', '13:00', '14:00', '15:00', '16:00'];

        times.forEach(time => {
            const btn = document.createElement('div');
            btn.className = 'btn btn-outline btn-sm text-center cursor-pointer';
            btn.textContent = time;
            btn.onclick = function () {
                document.querySelectorAll('#timeSlots .btn').forEach(b => b.classList.remove('btn-primary'));
                this.classList.add('btn-primary');
                this.classList.remove('btn-outline');
                // Add hidden input for time or update summary
                document.getElementById('summaryDateTime').textContent = this.textContent + ' on ' + document.getElementById('appointment_date').value;
            };
            slotsContainer.appendChild(btn);
        });
    });
</script>